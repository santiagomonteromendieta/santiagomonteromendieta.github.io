{% include base_path %}

<section class="page__share">
  {% if site.data.ui-text[site.locale].share_on_label %}
    <h4 class="page__share-title">{{ site.data.ui-text[site.locale].share_on_label | default: "Share on" }}</h4>
  {% endif %}

  <!-- X (formerly Twitter) -->
  <a href="https://twitter.com/intent/tweet?text={{ base_path }}{{ page.url }}" 
     class="btn btn--twitter" 
     title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} X">
     <i class="fab fa-twitter" aria-hidden="true"></i><span> X</span>
  </a>

  <!-- Facebook -->
  <a href="https://www.facebook.com/sharer/sharer.php?u={{ base_path }}{{ page.url }}" 
     class="btn btn--facebook" 
     title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} Facebook">
     <i class="fab fa-facebook" aria-hidden="true"></i><span> Facebook</span>
  </a>

  <!-- LinkedIn -->
  <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ base_path }}{{ page.url }}" 
     class="btn btn--linkedin" 
     title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} LinkedIn">
     <i class="fab fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span>
  </a>

  <!-- WeChat (Fixed) -->
  <a href="javascript:void(0);" 
     class="btn btn--wechat" 
     title="{{ site.data.ui-text[site.locale].share_on_label | default: 'Share on' }} WeChat"
     onclick="showWechatQR(event)">
     <i class="fab fa-weixin" aria-hidden="true"></i><span> WeChat</span>
  </a>
</section>

<!-- QR Code Modal -->
<div id="wechatQRModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <p>Scan QR code to share via WeChat</p>
    <div id="qrcode"></div>
  </div>
</div>

<style>
/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
}

.modal-content {
  background-color: #fff;
  margin: 15% auto;
  padding: 20px;
  width: 300px;
  text-align: center;
  border-radius: 5px;
}

.close {
  float: right;
  cursor: pointer;
  font-size: 24px;
}

/* WeChat Button Styling */
.btn--wechat {
  background-color: #07C160;
  color: #fff !important;
}

.btn--wechat:hover {
  background-color: #059a4a;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/qrcode.js/lib/qrcode.min.js"></script>
<script>
// QR Code Functions
function showWechatQR(event) {
  event.preventDefault(); // Prevent default anchor behavior
  const modal = document.getElementById('wechatQRModal');
  const currentUrl = window.location.href;
  
  // Clear previous QR code
  document.getElementById('qrcode').innerHTML = '';
  
  // Generate new QR code
  new QRCode(document.getElementById('qrcode'), {
    text: currentUrl,
    width: 256,
    height: 256,
    colorDark : "#000000",
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.H
  });

  modal.style.display = 'block';
  return false;
}

function closeModal() {
  document.getElementById('wechatQRModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
  const modal = document.getElementById('wechatQRModal');
  if (event.target === modal) {
    modal.style.display = "none";
  }
}
</script>
